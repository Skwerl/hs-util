<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Test Console</title>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>

<style type="text/css">
	#output {
		font-family: "Courier New", Courier, monospace;
		font-size: 12px;
		width: 100%;
		word-wrap: break-word;
	}
</style>

</head>

<body>
<div id="everything">
	<form id="form1" name="form1" method="post" action="/cmts/">
		<textarea name="data1" id="data1" cols="100" rows="10">{
    "patient": {
        "identity": "4429d93f-1ddc-4677-8625-f497ea708419",
        "firstName": "export",
        "lastName": "patient",
        "ssn": "345-34-1122",
        "address": [
            {
                "name": "Home",
                "address1": "2645 Mulberry Lane",
                "address2": "",
                "city": "Toledo",
                "state": "OH",
                "postalCode": "43605",
                "countryCode": "US",
                "phone": [
                    {
                        "areaCode": "234",
                        "prefix": "837",
                        "suffix": "2345",
                        "type": "OFFICE"
                    }
                ]
            }
        ],
        "phone": null,
        "email": null,
        "dob": "1960-04-24",
        "gender": "M",
        "language": "English",
        "patientConsent": null,
        "maritalStatus": null,
        "race": "A",
        "ethnicity": "H",
        "smoking": 2,
        "paymentProfile": null,
        "emergency": [
            {
                "name": "emergency",
                "phone": {
                    "areaCode": "234",
                    "prefix": "837",
                    "suffix": "2345",
                    "type": "OFFICE"
                }
            }
        ],
        "subscriberIsPatient": null,
        "insurance": null,
        "externalId": "5371091",
        "middleName": "d",
        "suffix": null,
        "preferredContact": null,
        "smokingFrequency": "1 pack/day",
        "ageInYears": 52
    },
    "medication": [
        {
            "drug": {
                "rcopiaId": null,
                "ndcid": "00071015640",
                "brandName": "Lipitor",
                "genericName": null,
                "fullDescription": null,
                "brandType": null,
                "form": "Tablet",
                "strength": null,
                "routeCode": null,
                "rxNormType": null,
                "rxNormId": null,
                "drugGroup": null
            },
            "note": [],
            "patientPrescription": [
                {
                    "prescribe": {
                        "prescribeIdentity": "70d4c765-1f6d-497c-8417-b58889bf30bf",
                        "patientIdentity": "4429d93f-1ddc-4677-8625-f497ea708419",
                        "patientExternalIdentity": "",
                        "pharmacyIdentity": "",
                        "hasScheduledDrug": false,
                        "stopDate": null,
                        "addToMedicationList": true,
                        "sig": {
                            "drug": {
                                "rcopiaId": null,
                                "ndcid": "00071015640",
                                "brandName": "Lipitor",
                                "genericName": null,
                                "fullDescription": null,
                                "brandType": null,
                                "form": "Tablet",
                                "strength": null,
                                "routeCode": null,
                                "rxNormType": null,
                                "rxNormId": null,
                                "drugGroup": null
                            },
                            "action": "Apply",
                            "dose": "1",
                            "doseUnit": "tablet",
                            "route": "as directed",
                            "doseTiming": "once a day",
                            "doseOther": null,
                            "duration": "7 days",
                            "quantity": "14",
                            "quantityUnits": "tablets",
                            "refills": "2",
                            "substitutionPermitted": true,
                            "otherNotes": "Other Notes",
                            "patientNotes": "Patient Notes",
                            "comments": "Comments",
                            "schedule": null,
                            "writtenDate": null,
                            "effectiveDate": null,
                            "lastFillDate": null,
                            "soldDate": null
                        },
                        "checkId": null,
                        "signaturePassword": "1234",
                        "prescriberOrderNumber": null,
                        "rxReferenceNumber": null,
                        "formularyNote": null,
                        "interactionNote": null,
                        "allergyReaction": null,
                        "interactionReaction": null,
                        "drugInteractionCheckPerformed": false,
                        "icd9": null,
                        "ePrescribe": false,
                        "createdBy": "f587ce0b-150b-4fd8-bcdf-bfb768ce7b71",
                        "createdByFirstName": "chuck",
                        "createdByLastName": "norris"
                    },
                    "createdAt": 1363199053574,
                    "createdBy": "f587ce0b-150b-4fd8-bcdf-bfb768ce7b71",
                    "active": true
                }
            ],
            "active": true,
            "source": "SOCIAL_CARE"
        }
    ],
    "problem": [
        {
            "problemNoteIdentity": "5a832c03-5c4e-467d-9fe8-075473e4c0fb",
            "icd9": {
                "code": "01116",
                "desc": "bronchitis"
            },
            "note": null,
            "problemStartedAt": null,
            "problemStoppedAt": null,
            "soapNoteIdentity": "fc79570c-dd0d-461e-9f96-17c42fd302ec",
            "significant": false,
            "active": true,
            "updatedAt": "2013-03-13T18:24:12.318Z",
            "createdBy": "f587ce0b-150b-4fd8-bcdf-bfb768ce7b71"
        },
        {
            "problemNoteIdentity": "705d624f-c6ea-44e0-bdc3-a427787460c9",
            "icd9": {
                "code": "0022",
                "desc": "flu"
            },
            "note": null,
            "problemStartedAt": null,
            "problemStoppedAt": null,
            "soapNoteIdentity": "fc79570c-dd0d-461e-9f96-17c42fd302ec",
            "significant": false,
            "active": true,
            "updatedAt": "2013-03-13T18:24:12.318Z",
            "createdBy": "f587ce0b-150b-4fd8-bcdf-bfb768ce7b71"
        },
        {
            "problemNoteIdentity": "2f3fbf82-266b-462f-b0eb-0a19a248747f",
            "icd9": {
                "code": "250.02",
                "desc": "Diabetes Mellitus, Type 2"
            },
            "note": "Low blood sugar",
            "problemStartedAt": "2009-12-24",
            "problemStoppedAt": null,
            "soapNoteIdentity": null,
            "significant": true,
            "active": false,
            "updatedAt": "2013-03-13T18:24:14.596Z",
            "createdBy": "f587ce0b-150b-4fd8-bcdf-bfb768ce7b71"
        }
    ],
    "allergy": [
        {
            "identity": "f378bf55-6f3d-45f9-b454-e2a012ebb87e",
            "name": "Allergy to penicillin",
            "ndcidCode": null,
            "allergyGroupId": null,
            "active": true,
            "allergicReaction": "Rash",
            "allergicReactionDate": "2001-01-01",
            "snomed": "91936005",
            "substance": null,
            "reaction": null,
            "createdAt": "2013-03-13",
            "updatedAt": "2013-03-13"
        }
    ],
    "immunization": [
        {
            "createTime": "2013-03-13T18:24:15.342Z",
            "vaccine": "Influenza",
            "notes": "Administered Flu Shot for patient",
            "userAssertion": "CONFIRMED",
            "activityTime": "2012-11-02",
            "activityBy": "CVS Pharmacy",
            "administeredAmount": "3",
            "administeredUnit": "vials",
            "vaccineLotNumber": "003843",
            "manufacturerName": "Merck",
            "manufacturerCode": "ME-394",
            "cvxCode": "15"
        }
    ],
    "soapNote": [
        {
            "identity": "fc79570c-dd0d-461e-9f96-17c42fd302ec",
            "subjective": {
                "chiefComplaint": "Knee pain",
                "note": "motorcycle injury",
                "symptoms": [
                    "grinding",
                    "headache",
                    "ear pain"
                ],
                "historyOfCurrentIllness": "previous surgery",
                "appointmentDate": "2012-01-19"
            },
            "objectiveVitals": {
                "vitalNotes": "getting basic measurements",
                "temperature": 99.1,
                "heightFeet": 5,
                "heightInches": 9,
                "respiratoryRate": 10,
                "weight": 165.3,
                "bpSystolic": 120,
                "bpDiastolic": 80,
                "pulse": 75,
                "headCircumference": 20.7,
                "oxygenSaturation": 82,
                "smoking": 2,
                "painPoints": [
                    {
                        "painLocation": "UPPER SHOULDER",
                        "painLevel": 3
                    }
                ],
                "smokingFrequency": "1 pack/day",
                "bmi": 24.410273
            },
            "objectivePhysical": {
                "physicalNotes": "patient is complaining of back pain and is unable to sleep",
                "problemAreas": [
                    {
                        "bodyPart": {
                            "name": "CHEST",
                            "category": "Inspection"
                        },
                        "notes": "Heartbeat regular",
                        "imageUrl": ""
                    },
                    {
                        "bodyPart": {
                            "name": "NEURO II-XII",
                            "category": "Sensory"
                        },
                        "notes": "No issues",
                        "imageUrl": ""
                    }
                ],
                "patientEducationTopicsDiscussed": [
                    "Asthma",
                    "Injury Prevention"
                ]
            },
            "assessment": {
                "notes": "minor back strain",
                "problems": [
                    {
                        "problemNoteIdentity": null,
                        "icd9": {
                            "code": "0022",
                            "desc": "flu"
                        },
                        "note": null,
                        "problemStartedAt": null,
                        "problemStoppedAt": null,
                        "soapNoteIdentity": "fc79570c-dd0d-461e-9f96-17c42fd302ec",
                        "significant": false,
                        "active": true,
                        "updatedAt": null,
                        "createdBy": null
                    },
                    {
                        "problemNoteIdentity": null,
                        "icd9": {
                            "code": "01116",
                            "desc": "bronchitis"
                        },
                        "note": null,
                        "problemStartedAt": null,
                        "problemStoppedAt": null,
                        "soapNoteIdentity": "fc79570c-dd0d-461e-9f96-17c42fd302ec",
                        "significant": false,
                        "active": true,
                        "updatedAt": null,
                        "createdBy": null
                    }
                ]
            },
            "plan": {
                "notes": "prescribing some painkillers, follow up in 2 weeks",
                "comments": "prescribing celebrex 300mg, minor sprain that should clear up in 2 weeks",
                "patientRequestedRecords": false
            },
            "updateBy": "f587ce0b-150b-4fd8-bcdf-bfb768ce7b71",
            "updatedAt": "2013-03-13T18:24:12.828Z",
            "createdBy": "f587ce0b-150b-4fd8-bcdf-bfb768ce7b71",
            "createdAt": "2013-03-13T18:24:08.616Z"
        }
    ],
    "lab": [
        {
            "labOrder": null,
            "labResult": {
                "identity": "7f1bc3cc-71ef-4e01-950c-505b1b602f42",
                "loincCode": "718-7",
                "labIdentity": "08bcebf1-da49-43b9-ae13-746ccc6ca246",
                "facilityName": "XYZ MRI Lab",
                "facilityStreetAddress": "101 Main Street",
                "facilityCity": "Los Angeles",
                "facilityState": "CA",
                "facilityPostalCode": "92617",
                "labTestResult": [
                    {
                        "date": "2013-01-01",
                        "type": "Hermatology",
                        "name": "Eosinophil Count (1-3%)",
                        "value": "2",
                        "unitOfMeasure": "%",
                        "source": "Not Applicable",
                        "condition": "Not Applicable",
                        "abnormal": false
                    },
                    {
                        "date": "2013-01-01",
                        "type": "Hermatology",
                        "name": "Hemoglobin (male: 14-18 g/dl female: 12-16 g/dl)",
                        "value": "16",
                        "unitOfMeasure": "g/dl",
                        "source": "Not Applicable",
                        "condition": "Not Applicable",
                        "abnormal": true
                    }
                ]
            },
            "labIdentity": "08bcebf1-da49-43b9-ae13-746ccc6ca246"
        }
    ],
    "author": "chuck norris",
    "organization": "Health Symmetric"
}</textarea><br/>
		<select name="format" id="format">
			<option value="ccd" selected>CCD</option>
			<option value="adt">ADT</option>
			<option value="oru">ORU</option>
			<option value="vxu">VXU</option>
		</select>
		<input type="submit" name="button" id="button1" value="Serialize JSON" />
	</form>
	<br/>
	<form id="form2" name="form2" method="post" action="/cmts/">
		<textarea name="data2" id="data2" cols="100" rows="10"></textarea><br/>
		<input type="submit" name="button" id="button2" value="Deserialize HL7" />
	</form>
<br><b>Output:</b> <span id="endpoint"></span><br><pre id="output"></pre>
</div>
</div>

<script type="text/javascript">

$(document).ready(function() {
	$("#form1").submit(function() {
		var endpoint = "/cmts/serialize/"+$("#format").val();
		$.post(endpoint, $("#data1").val(), function(data) {
			$("#output").html(safe_tags(data));
			$("#endpoint").html(endpoint);			
		}, "text");
		return false;
	});
	$("#form2").submit(function() {
		var endpoint = "/cmts/deserialize/";
		$.post(endpoint, $("#data2").val(), function(data) {
			$("#output").html(safe_tags(data));
			$("#endpoint").html(endpoint);			
		}, "text");
		return false;
	});
});

function safe_tags(str) {
    return str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
}

</script>

</body>
</html>